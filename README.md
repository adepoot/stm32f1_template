# STM32 - Environment setup example

This project is an example of how to setup a simple STM32 project environment, using `make`, `cmake` and `Docker`.

The original project files where generated using [STM32CubeMX](https://www.st.com/en/development-tools/stm32cubemx.html).

# Project structure

```
bluepill_makefile-example
├── Core  (generated by STM32CubeMX)
|   ├── ...
├── Drivers  (generated by STM32CubeMX)
|   ├── ...
├── project
|   ├── ...
├── toolchain  (generated by STM32CubeMX)
|   ├── ...
├── .mxproject  (generated by STM32CubeMX)
├── CMakeLists.txt
├── Dockerfile
├── gcc-arm-none-eabi.cmake
├── Makefile
```

`project`
contains the project's application files.

`CMakeLists.txt`
contains MCU specific information and needs to be adapted to your MCU.

`Dockerfile`
used to create the image which contains the necessary tools to build the project.

`gcc-arm-none-eabi.cmake`
contains info for compiler and linker, does not necessarily need to be changed.

`Makefile`
contains different commands to build the project.


# How to build the project?

In order for the build-process to be independent from one workstation to the other, a Docker container is used to build the application.

The `Makefile` contains all the possible build steps.

The most important/used ones are listed here:

```
make build
```
uses a Docker container to build the application. The output of this build process is put in the `build` folder of your workstation.

```
make shell
```
creates the Docker image, spins up a container and lets you enter the container. This container contains the necessary tools (compilers, linkers ...) to build the application.

```
make format
```
formats the project code according to the `.clang-format` file. The project code is located in the `project` folder.

```
make clean
```
deletes the `build` folder.

```
make clean-all
```
deletes the `build` folder and removes the Docker container and image.